"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2875,9892],{9892:(W,L,n)=>{n.d(L,{s:()=>E});const E=(0,n(7423).fo)("LocalNotifications",{web:()=>n.e(7434).then(n.bind(n,7434)).then(S=>new S.LocalNotificationsWeb)})},2875:(W,L,n)=>{n.d(L,{V:()=>_t});var a=n(655),E=n(5112),S=n(9892),Z=n(2340),R=(n(7423),n(5338)),g=n(3238),t=n(5e3),d=n(1892),M=n(7556),l=n(1335),f=n(8337),O=n(3769),u=n(7724),y=n(7326),G=n(520),v=n(4375),P=n(1862),T=n(9808),I=n(4182),h=n(9928);function F(r,x){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item",44)(1,"ion-grid",45)(2,"ion-row")(3,"ion-col",46)(4,"ion-row")(5,"ion-col",47),t._UZ(6,"img",48),t.qZA(),t.TgZ(7,"ion-col",46)(8,"ion-label")(9,"p",49),t._uU(10),t.qZA(),t.TgZ(11,"p",50)(12,"strong"),t._uU(13,"Precio"),t.qZA(),t._uU(14),t.ALo(15,"currency"),t.qZA()()()()(),t.TgZ(16,"ion-col",51)(17,"ion-grid")(18,"ion-row",52)(19,"ion-col",53)(20,"ion-button",54),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.sub(s))}),t._UZ(21,"ion-icon",55),t.qZA()(),t.TgZ(22,"ion-col",53)(23,"div",56),t._uU(24),t.qZA()(),t.TgZ(25,"ion-col",53)(26,"ion-button",54),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.add(s))}),t._UZ(27,"ion-icon",57),t.qZA()()()()()()()()}if(2&r){const e=x.$implicit,i=x.index,o=t.oxw(2);t.Q6J("lines",i==o.items.length-1?"none":"full"),t.xp6(6),t.Q6J("src",e.image,t.LSH),t.xp6(4),t.hij("",e.name," "),t.xp6(4),t.hij(" ",t.gM2(15,5,o.getPriceItem(e),"","symbol","1.0")," "),t.xp6(10),t.hij(" ",e.quantity," ")}}function q(r,x){if(1&r&&(t.TgZ(0,"ion-label"),t._uU(1),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.shop_selected.profile_settings?e.shop_selected.profile_settings.store_name:e.shop_selected.name,"")}}function j(r,x){1&r&&(t.TgZ(0,"ion-label"),t._UZ(1,"ion-skeleton-text",58),t.qZA())}function ot(r,x){1&r&&(t.TgZ(0,"ion-label",59),t._uU(1,"Tiempo estimado de entrega : 45-55 min"),t.qZA())}function it(r,x){if(1&r&&(t.TgZ(0,"ion-label",22),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.Oqu(t.gM2(2,1,e.price_logistic,"","symbol","1.0"))}}function st(r,x){1&r&&(t.TgZ(0,"ion-label",22),t._UZ(1,"ion-spinner",60),t.qZA())}function nt(r,x){if(1&r&&(t.TgZ(0,"ion-item",15)(1,"ion-label",21),t._uU(2,"Cup\xf3n"),t.qZA(),t.TgZ(3,"ion-label",22),t._uU(4),t.ALo(5,"currency"),t.qZA()()),2&r){const e=t.oxw(2);t.xp6(4),t.hij("-",t.gM2(5,1,e.coupon_discount,"","symbol","1.0"),"")}}function at(r,x){1&r&&(t.TgZ(0,"label"),t._uU(1,"APLICAR "),t.qZA())}function rt(r,x){1&r&&t._UZ(0,"ion-spinner",61)}function ct(r,x){if(1&r){const e=t.EpF();t.TgZ(0,"ion-slide",62),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.showProduct(s))}),t.TgZ(1,"ion-grid")(2,"ion-row")(3,"ion-thumbnail",63),t._UZ(4,"img",64),t.qZA()(),t.TgZ(5,"ion-row")(6,"ion-col",19)(7,"p",65),t._uU(8),t.ALo(9,"titlecase"),t.qZA()()()()()}if(2&r){const e=x.$implicit;t.xp6(4),t.Q6J("src",e.image,t.LSH),t.xp6(4),t.Oqu(t.lcZ(9,2,e.product))}}function lt(r,x){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",66),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.pay())}),t._uU(1," Hacer pedido "),t.qZA()}}const dt=function(r){return{invalid:r}};function ut(r,x){if(1&r){const e=t.EpF();t.TgZ(0,"ion-content",7)(1,"ion-item",8),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.showMap())}),t._UZ(2,"ion-icon",9),t.TgZ(3,"ion-label"),t._uU(4),t.qZA(),t._UZ(5,"ion-icon",10),t.qZA(),t.TgZ(6,"ion-list",11),t.YNc(7,F,28,10,"ion-item",12),t.qZA(),t.TgZ(8,"ion-card",13)(9,"div",14)(10,"ion-item",15)(11,"div",16)(12,"ion-item",15),t._UZ(13,"ion-img",17),t.YNc(14,q,2,1,"ion-label",18),t.YNc(15,j,2,0,"ion-label",18),t.qZA(),t.TgZ(16,"ion-row")(17,"ion-col",19),t.YNc(18,ot,2,0,"ion-label",20),t.qZA()()()()(),t.TgZ(19,"ion-card-content")(20,"ion-list")(21,"ion-item",15)(22,"ion-label",21),t._uU(23,"Subtotal"),t.qZA(),t.TgZ(24,"ion-label",22),t._uU(25),t.ALo(26,"currency"),t.qZA()(),t.TgZ(27,"ion-item",15)(28,"ion-label",21),t._uU(29,"Costo domicilio"),t.qZA(),t.YNc(30,it,3,6,"ion-label",23),t.YNc(31,st,2,0,"ion-label",23),t.qZA(),t.YNc(32,nt,6,6,"ion-item",24),t.TgZ(33,"ion-item",15)(34,"ion-label",21),t._uU(35,"Total"),t.qZA(),t.TgZ(36,"ion-label",22),t._uU(37),t.ALo(38,"currency"),t.qZA()()()()(),t.TgZ(39,"ion-card",25)(40,"ion-card-content")(41,"h5",26),t._uU(42,"\xbfTiene un cup\xf3n para redimir?"),t.qZA(),t.TgZ(43,"ion-item",27)(44,"ion-input",28),t.NdJ("keyup",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.keyUp())})("ngModelChange",function(o){t.CHM(e);const s=t.oxw();return t.KtG(s.coupon=o)}),t.qZA(),t.TgZ(45,"ion-button",29),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.applyCoupon())}),t.YNc(46,at,2,0,"label",18),t.YNc(47,rt,1,0,"ion-spinner",30),t.qZA()()()(),t.TgZ(48,"h5",31),t._uU(49,"Selecciona el m\xe9todo de pago"),t.qZA(),t.TgZ(50,"ion-grid")(51,"ion-row")(52,"ion-col",32)(53,"ion-button",33),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.selectPaymentMethod("efectivo"))}),t._UZ(54,"ion-icon",34),t.TgZ(55,"ion-label",35),t._uU(56,"Efectivo"),t.qZA()()(),t.TgZ(57,"ion-col",36)(58,"ion-button",33),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.selectPaymentMethod("Wompi"))}),t._UZ(59,"ion-icon",37),t.TgZ(60,"ion-label",35),t._uU(61,"Otros m\xe9todos"),t.qZA()()()()(),t.TgZ(62,"ion-card",38)(63,"ion-card-content",39)(64,"ion-col",40)(65,"ion-slides",41),t.YNc(66,ct,10,4,"ion-slide",42),t.qZA()()()(),t.YNc(67,lt,2,0,"ion-button",43),t.qZA()}if(2&r){const e=t.oxw();t.xp6(4),t.Oqu(e.auth.person.location?e.auth.person.location.address:"Por favor escoja su ubicaci\xf3n"),t.xp6(3),t.Q6J("ngForOf",e.items),t.xp6(7),t.Q6J("ngIf",!e.shopLoading),t.xp6(1),t.Q6J("ngIf",e.shopLoading),t.xp6(3),t.Q6J("ngIf",!e.shopLoading),t.xp6(7),t.hij(" ",t.gM2(26,19,e.auth.person.total?e.auth.person.total:0,"","symbol","1.0"),""),t.xp6(5),t.Q6J("ngIf",!e.cashLoading),t.xp6(1),t.Q6J("ngIf",e.cashLoading),t.xp6(1),t.Q6J("ngIf",e.isObjejctWithKeys(e.coupon_object)),t.xp6(5),t.hij("",t.gM2(38,24,e.coupon_discount?e.total-e.coupon_discount:e.total,"","symbol","1.0")," "),t.xp6(6),t.Q6J("ngClass",t.VKq(29,dt,e.error)),t.xp6(1),t.Q6J("ngModel",e.coupon),t.xp6(2),t.Q6J("ngIf",!e.loading),t.xp6(1),t.Q6J("ngIf",e.loading),t.xp6(6),t.Q6J("color","efectivo"==e.paymentMethod?"primary":"light"),t.xp6(5),t.Q6J("color","efectivo"==e.paymentMethod?"light":"primary"),t.xp6(7),t.Q6J("options",e.slideOpts),t.xp6(1),t.Q6J("ngForOf",e.feautured_products),t.xp6(1),t.Q6J("ngIf",e.items.length>0)}}function ht(r,x){1&r&&(t.TgZ(0,"ion-content",67),t._UZ(1,"img",68),t.TgZ(2,"h2",67),t._uU(3,"No hay productos en el carrito "),t.qZA()())}const V=function(r){return{"gray-background":r}};let _t=(()=>{class r{constructor(e,i,o,s,c,_,m,b,C,D,w){this.ui=e,this.auth=i,this.request=o,this.errorS=s,this.zone=c,this.router=_,this.iab=m,this.price=b,this.http=C,this.geolocation=D,this.map_service=w,this.feautured_products=[],this.items=[],this.coupon_object={},this.couponRedimi=!1,this.error=!1,this.loading=!1,this.shopLoading=!1,this.cashLoading=!1,this.slideOpts={initialSlide:0,speed:400,slidesPerView:3,autoplay:{delay:2e3}},this.address={address:"Calle 93 #7-39, Barranquilla, Atl\xe1ntico",latitude:"10.9495919",longitude:"-74.8352923",favorite:!1},this.distance=0,this.duration=0,this.paymentMethod="efectivo",this.defaults_location={1:"4.6034581,-74.0824232",2:"6.2507287,-75.5850634",3:"3.3692357,-76.5297074",4:"10.9909237,-74.8021089",5:"10.4252546,-75.5424482"},this.shop_id=0,this.price_logistic=0,this.shop_selected={},this.total_=0,this.coupon_discount=0}ngOnInit(){return(0,a.mG)(this,void 0,void 0,function*(){})}ionViewWillEnter(){return(0,a.mG)(this,void 0,void 0,function*(){this.auth.person.location||this.geolocation.getCurrentPosition().then(e=>{this.auth.person.location={latitude:e.coords.latitude,longitude:e.coords.longitude},this.map_service.findPlace(this.auth.person.location).then(i=>{i&&this.auth.setPerson(this.auth.person)})}),localStorage.getItem("coupon")&&(this.coupon_object=JSON.parse(localStorage.getItem("coupon"))),localStorage.getItem("address_selected")&&(this.address=JSON.parse(localStorage.getItem("address_selected"))),localStorage.getItem("payment_method")&&(this.paymentMethod=localStorage.getItem("payment_method")),this.items=[],this.auth.person.cart_items.length>0&&(this.shop_id=this.auth.person.cart_items[0].store.id,this.shopLoading=!0,this.request.get("/?option=shopById&id="+this.shop_id,!0).subscribe(i=>{console.log("Tienda",i),this.shopLoading=!1,this.shop_selected=i.data,this.getPrice(),localStorage.setItem("shop",JSON.stringify(this.shop_selected))},i=>{this.shopLoading=!1,console.log("Error Tienda")})),this.auth.person.cart_items.map(e=>{const i={id:e.id,name:e.product,price:Number(e.price),quantity:e.quantity,image:e.image,store:e.store,additional_price:Number(e.additional_price),radio_id:e.radio_id,additionals_ids:e.additionals_ids};this.items.push(i)}),this.loadProducts()})}loadProducts(){this.feautured_products=[],this.request.get("/?option=products_by_shop&id="+this.shop_id+"&page=1&per_page=10",!0).subscribe(e=>(0,a.mG)(this,void 0,void 0,function*(){console.log("Products",e.data);const i=e.data;i&&i.forEach(o=>{console.log("Producto",o);const s=o.meta_data.find(m=>"_wapf_fieldgroup"==m.key);let c=[];if(s){const m=s.value.fields;m&&m.map(b=>{c.push({label:b.label,price:b.options.choices[0]?Number(b.options.choices[0].pricing_amount):0,required:b.required,type:b.type,id:b.id,category_id:b.category_id,category_name:b.category_name})}),console.log("Medata Extras Fields",c)}this.feautured_products.push({id:o.id,image:o.images[0]?o.images[0].src:"assets/imgs/sinimagen.png",business:o.store?o.store.shop_name:"Mc Donalds",product:o.name,description:o.description?o.description:o.short_description?o.short_description:"Sin descripci\xf3n",price:o.price?o.price:2e4,time:"40-45 min",calification:"4.7",comments:"",store:o.store?o.store:{},fields:c,available:"instock"==o.stock_status,meta_data:o.meta_data,featured:o.featured,images:o.images})}),console.log("Products Array",this.feautured_products),this.feautured_products=this.feautured_products.sort((o,s)=>s.featured-o.featured),this.feautured_products=this.feautured_products.filter(o=>!this.items.find(s=>s.id==o.id))}),e=>(0,a.mG)(this,void 0,void 0,function*(){console.log("error",e),event&&e.status&&400==e.status||(e.status||this.errorS.response(e),e.status&&400!=e.status&&this.errorS.response(e))}))}showProduct(e){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.ui.presentModal(g.e,{product:e})).onDidDismiss().then(o=>{console.log("Cancel",o),o.data.cancel?e=o.data.product:(this.auth.person.total=0,this.auth.person.quantity=0,this.auth.person.cart_items&&this.auth.person.cart_items.length>0&&(this.items=[],this.auth.person.cart_items.map(s=>{const c={id:s.id,name:s.product,price:Number(s.price),quantity:s.quantity,image:s.image,store:s.store,additional_price:Number(s.additional_price),radio_id:s.radio_id,additionals_ids:s.additionals_ids};this.items.push(c)}),this.auth.person.cart_items.map(s=>{this.auth.person.total+=Number(s.quantity)*(Number(s.price)+(s.additional_price?Number(s.additional_price):0)),this.auth.person.quantity+=s.quantity,this.auth.setPerson(this.auth.person)})))})})}dismiss(){this.ui.dismiss()}view_order(e){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.ui.presentModal(R.G,{order:e},["custom-modal"])).onDidDismiss().then(o=>{})})}getDistanceMatrix(e,i,o){var s=new google.maps.DistanceMatrixService;return new Promise((_,m)=>{s.getDistanceMatrix({origins:[e],destinations:[i],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},function(b,C){return(0,a.mG)(this,void 0,void 0,function*(){if(C!=google.maps.DistanceMatrixStatus.OK)_({distance:0,duration:0}),console.log("Error was: "+C);else try{const{duration:w}=b.rows[0].elements[0];console.log("Response",b.rows[0].elements[0]);let K=b.rows[0].elements[0].distance.value;console.log("Distance Text",K);let J=w.value;_({distance:Math.round(Number(K)),duration:J})}catch(D){console.log("error",D)}})})})}applyCoupon(){return(0,a.mG)(this,void 0,void 0,function*(){if(this.coupon){if(this.couponRedimi)return void(yield this.ui.presentAlert({mode:"ios",header:"Ya se ha redimido un cup\xf3n en esta orden",buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:i=>{}}]}));const e={customer_id:this.auth.user.id,coupon_code:this.coupon,platform:"mobile"};this.loading=!0,this.error=!1,this.request.post("coupon/redeem_a_coupon",e).subscribe(i=>{this.loading=!1,this.error=!1,this.couponRedimi=!0,console.log("Res",i),this.coupon="";const o=i.data[0];o&&(this.total_=this.total,this.coupon_discount=40==o.type_value_id?Number(o.value)<=this.total_?Number(o.value):this.total:this.auth.person.total*(Number(o.value)/100),localStorage.setItem("couponRedimi","yes"),this.coupon_object=o,localStorage.setItem("coupon",JSON.stringify(o)),this.ui.presentAlert({mode:"ios",header:"Informaci\xf3n",message:"El cup\xf3n es aplicado solamente al total de los productos",buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:s=>{}}]}),this.ui.showToast("Se ha redimido tu cup\xf3n exitosamente"))},i=>{this.error=!0,this.loading=!1,console.log("Err",i),this.errorS.response(i,{method:()=>{console.log("Esto es una prueba de error")}})})}else this.error=!0,this.ui.showToast("Debe ingresar un cup\xf3n")})}pay(){"Wompi"!=this.paymentMethod?this.createOrder():this.payment()}generateGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0;return("x"==e?i:3&i|8).toString(16)})}searchTransaction(e,i){return(0,a.mG)(this,void 0,void 0,function*(){const o=yield this.ui.loading("Por favor espere...");localStorage.setItem("isWompiRequest","yes"),this.http.get(`${e}transactions/${i}`).subscribe(s=>(0,a.mG)(this,void 0,void 0,function*(){yield(yield o).dismiss();const _=s.data;localStorage.setItem("transaction",JSON.stringify(_)),"APPROVED"==_.status?this.createOrder():yield this.ui.presentAlert({mode:"ios",header:"Transacci\xf3n no aprobada",message:{PENDING:"La transacci\xf3n se encuentra en estado pendiente",APPROVED:"Aprobado",DECLINED:"La transacci\xf3n ha sido rechazada",ERROR:"Se ha producido un error con la transacci\xf3n",VOIDE:"I don\xb4t know"}[_.status],buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:m=>{}}]}),console.log("event url transaction",s)}),s=>(0,a.mG)(this,void 0,void 0,function*(){if(yield o.dismiss(),401!=s.status&&404!=s.status)if(422!=s.status)console.log("event url error",JSON.stringify(s.error));else{const c=s.error?s.error.messages.reference[0]:"Error mensage";yield this.ui.presentAlert({mode:"ios",header:"Error",message:c,buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:_=>{}}]})}else{const c=404==s.status?"Error no se encontr\xf3 el id":"Error al consultar la transacci\xf3n "+i,_=s.error?s.error.reason:c;yield this.ui.presentAlert({mode:"ios",header:"Error",message:_,buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:m=>{}}]})}}))})}payment(){let{publicKey:i,currency:o,postUrl:s,responseUrl:c,urlToFind:_}=Z.N.wompiCredentials;console.log("Wompi Credentials",Z.N.wompiCredentials);let C=`\n            <html>\n              <body>\n                <form action="${s}" method="get" id="payu_form">\n                <input name="reference"    type="hidden"  value="${this.generateGuid()}"   >\n                  <input name="public-key"    type="hidden"  value="${i}"   >\n                  <input name="currency"      type="hidden"  value="${o}">\n                  <input type="hidden" name="amount-in-cents" value="${100*(this.coupon_discount?this.total-this.coupon_discount:this.total)}"/>\n                  <input name="redirect-url"    type="hidden"  value="${c}" >\n                  <button type="submit" value="submit" #submitBtn></button>\n                </form>\n                <script type="text/javascript">document.getElementById("payu_form").submit();<\/script>\n              </body>\n            </html>`;C="data:text/html;base64,"+btoa(C);const D=this.iab.create(C,"_self",{location:"no",clearcache:"yes",hardwareback:"yes",mediaPlaybackRequiresUserAction:"no",shouldPauseOnSuspend:"no",closebuttoncaption:"Close",disallowoverscroll:"yes",toolbar:"yes",toolbartranslucent:"yes",enableViewportScale:"no",allowInlineMediaPlayback:"no",presentationstyle:"pagesheet",toolbarposition:"bottom"});console.log("Browser",D),D.on("loadstart").subscribe(w=>(0,a.mG)(this,void 0,void 0,function*(){if(console.log("event url",w.url),w.url.includes(c)){D.close();const K=w.url.replace(c+"?","").split("&").find(J=>J.includes("id=")).replace("id=","");console.log("event url Id",K),this.searchTransaction(_,K)}}))}getPrice(){return(0,a.mG)(this,void 0,void 0,function*(){this.cashLoading=!0;try{this.shop_selected.profile_settings.location||(console.log("Set Location"),this.shop_selected.profile_settings.location=this.defaults_location[4],localStorage.setItem("shop",JSON.stringify(this.shop_selected)));const o=this.shop_selected.profile_settings.location.split(",");console.log("Latitude",o[0],"Longitude",o[1]);const s={lat:parseFloat(o[0]),lng:parseFloat(o[1])},c={lat:this.auth.person.location.latitude,lng:this.auth.person.location.longitude};let{distance:_,duration:m}=yield this.getDistanceMatrix(s,c);if(0==_||0==m)return void console.log("Distance =0");_=Number((_/1e3).toFixed(_>=1e3?0:1)),m=Number(m>=3600?(m/3600).toFixed(0):(m/60).toFixed(0));const b=yield this.price.getTotalStore(_,"Motorizado",0,0,4);if(console.log("Distance",_),console.log("Price",b),this.price_logistic=50*Math.round(b/50),this.cashLoading=!1,this.distance=_,this.duration=m,this.coupon_object){console.log("Coupon",this.coupon_object);const C=this.auth.person.total+this.price_logistic;this.coupon_discount=40==this.coupon_object.type_value_id?Number(this.coupon_object.value)<=this.total?Number(this.coupon_object.value):C:C*(Number(this.coupon_object.value)/100)}}catch(e){this.cashLoading=!1}})}createOrder(){return(0,a.mG)(this,void 0,void 0,function*(){const{user:e}=this.auth;console.log("User",e),this.shop_selected.profile_settings.location||(console.log("Set Location"),this.shop_selected.profile_settings.location=this.defaults_location[this.auth.person.city_selected?this.auth.person.city_selected.id:this.auth.person.city_id],localStorage.setItem("shop",JSON.stringify(this.shop_selected)));const o=[],s=this.shop_selected.profile_settings.location.split(","),c={lat:parseFloat(s[0]),lng:parseFloat(s[1])};let m=" ",b=this.auth.person.cart_items.map(p=>p.id+"/"+p.quantity).join(","),C=[];this.auth.person.cart_items.forEach(p=>{m+=p.product+"X"+p.quantity+" "+p.comments+", ";const $=p.fields.filter(U=>p.additional_radio.find(k=>k==U.id)||p.additionals_ids.find(k=>k==U.id)).map(U=>({name:U.label,price:U.price.toString()})),vt=this.coupon_discount&&this.coupon_discount>0?this.coupon_discount/this.auth.person.cart_items.length:0;C.push({product_id:p.id,note:`${p.product} ${p.comments}`,quantity:p.quantity,total:this.getPriceItem(p)-vt,additionals:$}),C.forEach(U=>{Object.keys(U).forEach(k=>{"additionals"!=k&&(U[k]=U[k].toString())})})}),console.log("Product Aditionals",C);const{first_name:D,last_name:w,phone:K,city:J,state_id:pt}=this.auth.person,mt=this.auth.person.city_selected?this.auth.person.city_selected.name:J;let B="";switch(this.auth.person.city_selected?this.auth.person.city_selected.state_id:pt){case 1:B="CU";break;case 2:B="VC";break;case 3:B="AT";break;case 4:B="BO";break;case 5:B="AN"}const{email:bt}=this.auth.user;let z,Y;switch(this.paymentMethod){case"efectivo":Y="cod",z="Contra Entrega";break;case"Wompi":Y="payulatam",z="PayU Latam";break;default:Y="bacs",z="Direct Bank Transfer"}const X={payment_method:Y,payment_method_title:z,first_name:D,last_name:w,phone:K,city:mt,state:B,address_1:this.auth.person.location.address,address_2:"abc 123",postcode:"00008",email:bt,items:C,customer_id:0,set_paid:"efectivo"!=this.paymentMethod};console.log("Items",b);let tt="Recoger en "+this.shop_selected.profile_settings.store_name+" los productos ";tt+=m;const et={collect_description:tt,delivery_description:"Entregar los productos "+m};o[0]={title:"",address:this.shop_selected.profile_settings.find_address?this.shop_selected.profile_settings.find_address:this.shop_selected.profile_settings.address.street_1,latitude:c.lat,longitude:c.lng,description:et.collect_description,contact_name:this.shop_selected.profile_settings.store_name,contact_phone:this.shop_selected.profile_settings.phone},o[1]={title:"",address:this.auth.person.location.address,latitude:this.auth.person.location.latitude,longitude:this.auth.person.location.longitude,description:et.delivery_description,contact_name:this.auth.user.name,contact_phone:this.auth.person.phone};const Q={customer_id:e.id,service_type_id:1,transport_type_id:4,hourly_value:0,number_hours:0,driver_count:0,city_id:this.auth.person.city_selected?this.auth.person.city_selected.id:this.auth.person.city_id,round_trip:0,distance:this.distance,duration:this.duration,diligence:0,date:this.formatDated(),range:"09:30PM - 10:00PM",declared_value:0,total:this.price_logistic,zapp_tool:"Maleta de Alimentos",payment_method:this.paymentMethod,address_arr:o,branch_office_id:0,zapp_store_order:1,seller_id:this.shop_selected.ID?this.shop_selected.ID:this.shop_selected.id,wc_order_id:0,cash_handling:"efectivo"==this.paymentMethod?1:0,total_zapp_store:this.coupon_discount?this.total-this.coupon_discount:this.total,seller:this.shop_selected,products:this.auth.person.cart_items.map(p=>Object.assign(Object.assign({},p),{category:""}))};console.log("Parameters",Q),console.log("Object WordPress",X);const H=yield this.ui.loading("Por favor espere...");this.request.post("/?option=create_order",X,!0).subscribe(p=>{console.log("Respuesta wordpress",p),Q.wc_order_id=p.data.id,console.log("Parameters ",Q),this.request.post("order/store_order",Q).subscribe(N=>(0,a.mG)(this,void 0,void 0,function*(){(yield H).dismiss(),this.auth.person.cart_items=[],localStorage.removeItem("address_selected"),localStorage.removeItem("shop"),localStorage.removeItem("payment_method"),localStorage.removeItem("couponRedimi"),localStorage.removeItem("coupon"),console.log("Order Zapp",N),this.auth.setPerson(this.auth.person),this.ui.showToast("Orden Creada",()=>(0,a.mG)(this,void 0,void 0,function*(){this.dismiss(),this.view_order(N.data[0]),yield S.s.schedule({notifications:[{title:"Orden "+N.data[0].id+" Creada",body:"Estamos buscando el mensajero m\xe1s cercano",id:Math.round(100*Math.random()),autoCancel:!0}]})}))}),N=>(0,a.mG)(this,void 0,void 0,function*(){(yield H).dismiss(),console.log("Error",N),N.error&&N.error.messages?yield this.ui.presentAlert({mode:"ios",header:N.error.messages[0],buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:$=>{}}]}):yield this.ui.presentAlert({mode:"ios",header:"No se ha podido crear la orden",message:"Error de conexi\xf3n o servidor",buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:$=>{}}]})}))},p=>(0,a.mG)(this,void 0,void 0,function*(){(yield H).dismiss(),console.log("Error",p),p.error&&p.error.messages?yield this.ui.presentAlert({mode:"ios",header:p.error.messages[0],buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:N=>{}}]}):yield this.ui.presentAlert({mode:"ios",header:"No se ha podido crear la orden en la tienda",buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:N=>{}}]})}))})}get total(){return console.log("Cupon"),this.auth.person.total+(this.price_logistic?this.price_logistic:0)}isObjejctWithKeys(e){return Object.keys(e).length>0}formatDated(){let e=new Date,i=""+e.getDate(),o=""+(e.getMonth()+1),s=e.getFullYear();return o.length<2&&(o="0"+o),i.length<2&&(i="0"+i),console.log("Fecha",[s,o,i].join("-")),[s,o,i].join("-")}keyUp(){this.error=!1}showMap(){return(0,a.mG)(this,void 0,void 0,function*(){let i={city:this.auth.person.city,latitude:this.auth.person.location?this.auth.person.location.latitude:this.address.latitude,longitude:this.auth.person.location?this.auth.person.location.longitude:this.address.longitude,icon:"a.png",address:this.auth.person.location?this.auth.person.location.address:this.address.address};(yield this.ui.presentModal(E.s,i,["custom-modal"])).onDidDismiss().then(()=>{if(localStorage.getItem("address_item")){let s=JSON.parse(localStorage.getItem("address_item"));this.address.address=s.address,this.address.latitude=s.lat,this.address.longitude=s.lng,this.auth.person.location||(this.auth.person.location={}),this.auth.person.location.address=s.address,this.auth.person.location.latitude=s.lat,this.auth.person.location.longitude=s.lng,this.auth.setPerson(this.auth.person),this.address.favorite=s.favorite,localStorage.setItem("address_selected",JSON.stringify(this.address)),this.getPrice(),localStorage.removeItem("address_item")}})})}add(e){console.log("Product",e),e.quantity++;const i=this.auth.person.cart_items.findIndex(o=>o.id==e.id);-1!=i?(this.auth.person.cart_items[i]=Object.assign(Object.assign({},this.auth.person.cart_items[i]),{quantity:e.quantity}),this.auth.person.total=0,this.auth.person.quantity=0,this.auth.person.cart_items&&this.auth.person.cart_items.length>0&&this.auth.person.cart_items.map(o=>{this.auth.person.total+=Number(o.quantity)*(Number(o.price)+(o.additional_price?Number(o.additional_price):0)),this.auth.person.quantity+=o.quantity,this.auth.setPerson(this.auth.person)}),this.auth.setPerson(this.auth.person)):console.log("No se ha encontrado")}getPriceItem(e){return(Number(e.price)+Number(e.additional_price?e.additional_price:0))*Number(e.quantity)}sub(e){if(e.quantity>1){e.quantity--;const i=this.auth.person.cart_items.findIndex(o=>o.id==e.id);-1!=i&&(this.auth.person.cart_items[i]=Object.assign(Object.assign({},this.auth.person.cart_items[i]),{quantity:e.quantity}),this.auth.person.total=0,this.auth.person.quantity-=e.quantity,this.auth.person.cart_items&&this.auth.person.cart_items.length>0&&this.auth.person.cart_items.map(o=>{this.auth.person.total+=o.quantity*(Number(o.price)+(o.additional_price?o.additional_price:0)),this.auth.setPerson(this.auth.person)}),this.auth.setPerson(this.auth.person))}else 1==e.quantity&&(e.quantity--,1==this.auth.person.cart_items.length?(this.auth.person.cart_items=[],this.auth.person.total=0,this.auth.person.quantity=0,localStorage.removeItem("address_selected"),localStorage.removeItem("shop"),localStorage.removeItem("payment_method"),localStorage.removeItem("couponRedimi"),localStorage.removeItem("coupon"),this.auth.setPerson(this.auth.person),this.dismiss()):(this.auth.person.total-=e.price,this.auth.person.quantity-=e.quantity,this.items=this.items.filter(i=>i.id!=e.id),this.auth.person.cart_items=this.auth.person.cart_items.filter(i=>i.id!=e.id),this.auth.setPerson(this.auth.person)),e.additional_price=0,e.additionals_ids=[],e.radio_id=""),this.auth.person.total=0,this.auth.person.quantity=0,this.auth.person.cart_items&&this.auth.person.cart_items.length>0&&this.auth.person.cart_items.map(i=>{this.auth.person.total+=Number(i.quantity)*(Number(i.price)+(i.additional_price?Number(i.additional_price):0)),this.auth.person.quantity+=i.quantity,this.auth.setPerson(this.auth.person)})}findPlace(e){return(0,a.mG)(this,void 0,void 0,function*(){let i=new google.maps.Geocoder,o=new google.maps.LatLng(this.address.latitude,this.address.longitude);const s=yield this.ui.loading(e||"Por favor espere...");var c=this;i.geocode({latLng:o},(_,m)=>(0,a.mG)(this,void 0,void 0,function*(){(yield s).dismiss(),m==google.maps.GeocoderStatus.OK?(console.log(_[0]),console.log("Este es el find place"),c.zone.run(()=>{c.address.address=_[0].formatted_address,c.address.latitude=_[0].geometry.location.lat(),c.address.longitude=_[0].geometry.location.lng(),localStorage.setItem("address_selected",JSON.stringify(this.address))})):yield this.ui.presentAlert({mode:"ios",header:"No se ha podido mostrar la informaci\xf3n",buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:b=>{}}]})}))})}saveFavoriteAddress(e){return(0,a.mG)(this,void 0,void 0,function*(){e&&(e.favorite||(e.address&&e.latitude&&e.longitude?yield this.ui.presentAlert({mode:"ios",header:"Seleccionar esta direcci\xf3n como favorita ",inputs:[{name:"name_shorcut",id:"name_shorcut",type:"text",placeholder:"Nombre de alias",mode:"ios"},{name:"description",id:"description",type:"textarea",placeholder:"Descripci\xf3n",mode:"ios"}],buttons:[{text:"Registar",cssClass:"secondary",handler:i=>(0,a.mG)(this,void 0,void 0,function*(){const o={customer_id:this.auth.user.id,address:e.address,latitude:e.latitude,longitude:e.longitude,name_shortcut:i.name_shorcut,description:i.description},s=yield this.ui.loading("Por favor espere...");this.request.post("customer/add_favourite_address",o).subscribe(c=>(0,a.mG)(this,void 0,void 0,function*(){(yield s).dismiss(),console.log("Res ",c),e.favorite=!0,localStorage.setItem("address_selected",JSON.stringify(this.address)),this.auth.user.customer_addresses||(this.auth.user.customer_addresses=[]),this.auth.user.customer_addresses.push(o),this.auth.setUser(this.auth.user)}),c=>(0,a.mG)(this,void 0,void 0,function*(){console.log("Err ",c),(yield s).dismiss(),this.errorS.response(c)}))})}]}):e.address||(yield this.ui.presentAlert({mode:"ios",header:"Seleccione una direcci\xf3n",buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:i=>{}}]}))))})}selectPaymentMethod(e){this.paymentMethod=e}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(d.F),t.Y36(M.e),t.Y36(l.s),t.Y36(f.Y),t.Y36(t.R0b),t.Y36(O.F0),t.Y36(u.i),t.Y36(y.N),t.Y36(G.eN),t.Y36(v._),t.Y36(P.z))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-cart"]],decls:8,vars:8,consts:[["mode","ios",2,"position","relative",3,"ngClass"],["lines","none",3,"ngClass"],["fill","clear",2,"--color","black","width","60px",3,"click"],["slot","start","name","back",2,"font-size","2.5em"],[2,"font-weight","bold","font-size","1.3em"],["class","gray-background",4,"ngIf"],["class","ion-text-center",4,"ngIf"],[1,"gray-background"],["lines","none",1,"address",3,"click"],["name","location-icon",1,"button-location"],["name","caret-down-outline"],[1,"product-list"],["style","--padding-start: 0;\n    --padding-end: 0;\n    --inner-padding-end: 0;",3,"lines",4,"ngFor","ngForOf"],["mode","ios",1,"card-shop"],[1,"header"],["lines","none"],[2,"margin","auto","width","80%"],["src","assets/imgs/restaurant.png","slot","start"],[4,"ngIf"],["size","12"],["class","m-l-10","style","font-size: 0.7em;text-align: center; color: #80808080;",4,"ngIf"],["slot","start",1,"left-item"],["slot","end"],["slot","end",4,"ngIf"],["lines","none",4,"ngIf"],["mode","ios",1,"",2,"margin-top","0","margin-bottom","0"],[1,"ion-text-center","m-t-0"],["lines","none",1,"coupon_redeem","no-inner-padding",3,"ngClass"],["placeholder","Ingresa tu cup\xf3n",3,"ngModel","keyup","ngModelChange"],["mode","ios","slot","end",1,"primary-yellow-background","rounded",3,"click"],["style","    height: 20px;\n        ",4,"ngIf"],[1,"ion-text-center",2,"color","#49158c","font-weight","900","margin-top","5px","margin-bottom","5px"],["size","6",2,"height","50px","text-align","right"],[2,"width","150px","height","100%",3,"color","click"],["name","metodo-de-pago"],[2,"font-size","smaller","font-family","'GILROY-EXTRABOLD' !important","text-transform","capitalize"],["size","6",2,"height","50px"],["name","tarjeta-de-debito",2,"font-size","2em"],["mode","ios",1,"m-top-20",2,"padding","0","margin-top","5px","height","140px","margin-bottom","10px","margin-top","8px"],[2,"padding","0","line-height","normal","padding-left","5px","padding-right","5px"],["size","12",2,"padding","0","padding-top","0px"],[3,"options"],["class","slide","style","position: relative;",3,"click",4,"ngFor","ngForOf"],["expand","block","class","semi-rounded","style","    width: 90%;\n    margin: 3px auto;",3,"click",4,"ngIf"],[2,"--padding-start","0","--padding-end","0","--inner-padding-end","0",3,"lines"],[1,"ion-no-bottom-padding",2,"width","100%"],["size","8",1,"ion-no-bottom-padding"],["size","4",1,"ion-no-bottom-padding"],["alt","",1,"image",3,"src"],[1,"grey-color-text"],[1,"black-color-text",2,"font-size","1.1em","font-weight","bolder"],["size","4",1,"ion-no-bottom-padding",2,"display","flex","align-items","center","padding","0"],[1,"btn-quantity"],["size","4",1,"ion-no-padding"],["fill","clear","size","small",2,"--color","#49158c",3,"click"],["name","trash"],[1,"quantity"],["name","add"],["animated",""],[1,"m-l-10",2,"font-size","0.7em","text-align","center","color","#80808080"],["color","primary"],[2,"height","20px"],[1,"slide",2,"position","relative",3,"click"],[2,"width","100%","height","90%"],[3,"src"],[2,"white-space","nowrap","text-overflow","ellipsis","max-width","120px","display","block","overflow","hidden","margin","0"],["expand","block",1,"semi-rounded",2,"width","90%","margin","3px auto",3,"click"],[1,"ion-text-center"],["src","assets/imgs/empty-and-lost.gif","alt","",2,"height","60%"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-toolbar",0)(1,"ion-item",1)(2,"ion-button",2),t.NdJ("click",function(){return i.dismiss()}),t._UZ(3,"ion-icon",3),t.qZA(),t.TgZ(4,"ion-title",4),t._uU(5,"Carrito "),t.qZA()()(),t.YNc(6,ut,68,31,"ion-content",5),t.YNc(7,ht,4,0,"ion-content",6)),2&e&&(t.Q6J("ngClass",t.VKq(4,V,i.items.length>0)),t.xp6(1),t.Q6J("ngClass",t.VKq(6,V,i.items.length>0)),t.xp6(5),t.Q6J("ngIf",i.items.length>0),t.xp6(1),t.Q6J("ngIf",0==i.items.length))},dependencies:[T.mk,T.sg,T.O5,I.JJ,I.On,h.YG,h.PM,h.FN,h.wI,h.W2,h.jY,h.gu,h.Xz,h.pK,h.Ie,h.Q$,h.q_,h.Nd,h.CK,h.A$,h.Hr,h.PQ,h.Bs,h.sr,h.wd,h.j9,T.rS,T.H9],styles:[".line-through[_ngcontent-%COMP%]{text-decoration:line-through;font-size:16px;color:#666}.sale[_ngcontent-%COMP%]{color:red!important}.address[_ngcontent-%COMP%]{width:90%;--background: transparent;margin:0 auto}.change-method[_ngcontent-%COMP%]{--background: white;width:100px}.change-method[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{overflow:visible;overflow:initial}.price[_ngcontent-%COMP%]{color:#333e48;font-size:27px}.description[_ngcontent-%COMP%]{color:#666}.btn-quantity[_ngcontent-%COMP%]{border:#cecaca solid 1px;border-radius:10px;background:#f4f4f4;color:#49158c;font-weight:700}.quantity[_ngcontent-%COMP%]{padding-top:5px;text-align:center;font-size:20px}.product-list[_ngcontent-%COMP%]{padding:0;width:90%;margin:auto;border-radius:20px;box-shadow:-2px 6px 9px -6px #000000bf}.product-list[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:70px;height:45px;-o-object-fit:initial;object-fit:initial;display:block}.slide[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{width:100%;height:100%}.slide[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:20px;width:120px;height:100px}.gray-background[_ngcontent-%COMP%]{--background: rgb(204 204 204 / 14%)}.m-top-20[_ngcontent-%COMP%]{margin-top:20px}.m-t-0[_ngcontent-%COMP%]{margin-top:0}.coupon_redeem[_ngcontent-%COMP%]{border:2px solid #a1e110;border-radius:20px}.coupon_redeem[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background-activated: #a1e110;margin:0 5px;height:30px}.payment-label[_ngcontent-%COMP%]{white-space:break-spaces;font-size:.7em}.left-item[_ngcontent-%COMP%]{text-align:left!important;margin-left:30px}.ion-no-bottom-padding[_ngcontent-%COMP%]{padding-top:2px;padding-bottom:2px;--padding-bottom: 0}.card-shop[_ngcontent-%COMP%]{padding:0;height:239px;margin-bottom:5px;margin-top:5px}.card-shop[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{padding:5px}.card-shop[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{width:85px;height:72px}.card-shop[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1em;font-weight:700}.card-shop[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0}.card-shop[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .m-l-10[_ngcontent-%COMP%]{margin-left:10px}.card-shop[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{margin:auto}.card-shop[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{font-size:.8em}.card-shop[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{overflow:visible;overflow:initial;font-weight:700}.card-shop[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:last-child{--background: rgb(204 204 204 / 14%)}"]}),r})()},4375:(W,L,n)=>{n.d(L,{_:()=>t});var a=n(655),E=n(7423),S=n(4549),Z=n(6090),A=n(5e3),R=n(6425),g=n(1892);let t=(()=>{class d{constructor(l,f){this.diagnostic=l,this.ui=f}getCurrentPosition(l){return(0,a.mG)(this,void 0,void 0,function*(){let f,O,u;if("web"!==E.dV.platform?(u=yield this.diagnostic.isNetworkLocationAvailable(),O=yield this.diagnostic.isNetworkLocationEnabled(),f=yield this.diagnostic.isGpsLocationEnabled(),O=yield this.diagnostic.isGpsLocationAvailable()):(u=!0,O=!0,f=!0,O=!0),console.log(` Geolocation Enabled Network ${u} available Network undefined`),console.log(` Geolocation Enabled ${f} available ${O}`),u||f)try{let v;return console.log(" Geolocation is Enabled "),v=l?yield Z.b.getCurrentPosition(l):yield Z.b.getCurrentPosition(),console.log(" Geolocation is Enabled Latitude",v.coords.latitude,"Geolocation is Enabled Longitude",v.coords.longitude),localStorage.setItem("latitude",v.coords.latitude.toString()),localStorage.setItem("longitude",v.coords.longitude.toString()),v}catch(v){if(console.log(" Geolocation Catch Error"),localStorage.getItem("latitude")&&localStorage.getItem("longitude"))return console.log(" Geolocation Catch Error Have Position"),{coords:{latitude:parseFloat(localStorage.getItem("latitude")),longitude:parseFloat(localStorage.getItem("longitude")),accuracy:0,altitude:0,altitudeAccuracy:0,heading:0,speed:0},timestamp:Date.now()};console.log(" Geolocation Catch Error Don\xb4t Have Position"),this.showNotInStock()}else this.showNotInStock()})}showModal(l){return(0,a.mG)(this,void 0,void 0,function*(){yield this.ui.presentModal(S.G,l,["modal-xs"])})}showNotInStock(){return(0,a.mG)(this,void 0,void 0,function*(){this.showModal({image:"assets/imgs/location-animation.gif",title:"Por favor, active su ubicaci\xf3n",color_message:"#eb445a",color_title:"#5952fd"})})}isLocationEnabled(){return(0,a.mG)(this,void 0,void 0,function*(){let l,f;"web"!==E.dV.platform?(l=yield this.diagnostic.isGpsLocationEnabled(),f=yield this.diagnostic.isGpsLocationAvailable()):(l=!1,f=!1),console.log(`Enabled ${l} available ${f}`),l||this.showNotInStock()})}}return d.\u0275fac=function(l){return new(l||d)(A.LFG(R.R),A.LFG(g.F))},d.\u0275prov=A.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},1862:(W,L,n)=>{n.d(L,{z:()=>Z});var a=n(655),E=n(5e3),S=n(1892);let Z=(()=>{class A{constructor(g){this.ui=g}findPlace(g){return(0,a.mG)(this,void 0,void 0,function*(){let t=new google.maps.LatLng(g.latitude,g.longitude);const d=yield this.getAddressBylocation(t);return g.address=d||g.address,d})}getAddressBylocation(g){return(0,a.mG)(this,void 0,void 0,function*(){let t=new google.maps.Geocoder;return new Promise((d,M)=>{t.geocode({latLng:g},(l,f)=>(0,a.mG)(this,void 0,void 0,function*(){f==google.maps.GeocoderStatus.OK?(console.log(l[0]),console.log("Direcci\xf3n",l[0].formatted_address),d(l[0].formatted_address)):(yield this.ui.presentAlert({mode:"ios",header:"No se ha podido mostrar la informaci\xf3n",buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:O=>{}}]}),d(""))}))})})}getAddressLocation(g){return(0,a.mG)(this,void 0,void 0,function*(){let t=new google.maps.Geocoder;return new Promise((d,M)=>{t.geocode({address:g,componentRestrictions:{country:"CO",postalCode:"080001"}},(l,f)=>(0,a.mG)(this,void 0,void 0,function*(){f==google.maps.GeocoderStatus.OK?(console.log(l[0]),console.log("Direcci\xf3n",l[0].formatted_address),d({latitude:l[0].geometry.lat,longitude:l[0].geometry.lng})):(yield this.ui.presentAlert({mode:"ios",header:"No se ha podido mostrar la informaci\xf3n",message:f,buttons:[{text:"Aceptar",role:"cancel",cssClass:"secondary",handler:O=>{}}]}),d({}))}))})})}findAddress(g){return(0,a.mG)(this,void 0,void 0,function*(){return yield this.getAddressLocation(g.address)})}}return A.\u0275fac=function(g){return new(g||A)(E.LFG(S.F))},A.\u0275prov=E.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),A})()},7326:(W,L,n)=>{n.d(L,{N:()=>R});var a=n(655),E=n(5e3),S=n(1335),Z=n(1892),A=n(7556);let R=(()=>{class g{constructor(d,M,l){this.request=d,this.ui=M,this.auth=l,this.taxes={}}calculate_price(d,M,l,f,O){return(0,a.mG)(this,void 0,void 0,function*(){return this.getTotal(d,M,l,f,O)})}getTotalStore(d,M,l,f,O){return(0,a.mG)(this,void 0,void 0,function*(){let u=0;return new Promise((y,G)=>{this.request.get("get_pricing_for_order").subscribe(v=>(0,a.mG)(this,void 0,void 0,function*(){console.log("Res",v);const P=v.data.find(j=>j.transport_type_id==O);let T=Number(P.rate_base),I=Number(P.minimal_distance?P.minimal_distance:P.km_base),h=Number(P.value_per_distance?P.value_per_distance:P.km_unit_value),F=Number(P.peripheries?P.peripheries:P.neighboring_base);console.log("Taxes",this.auth.user.taxes);var q=0;if("Motorizado"==M||"Carry"==M)d>I?(q=Math.abs(d-I),u=T+q*h,console.log("Price Carry",u)):u=T,1==l&&(u+=F);else if("Autom\xf3vil"==M){if(d>I){const j=h*(q=Math.abs(d-I))+q*(.25*h);console.log("Distance chage price",j),u=T+j,u=Math.round(u)}else u=T;1==l&&(u+=F)}console.log("Price Distance",d),console.log("price es :"+u+" rate "+h),y(u)}),v=>(0,a.mG)(this,void 0,void 0,function*(){y(u)}))})})}getTotal(d,M,l,f,O){var u=0;let y=this.auth.user.configuration_data.find(h=>h.transport_type_id==O);y||localStorage.getItem("configuration_data")&&(y=JSON.parse(localStorage.getItem("configuration_data")));let G=Number(y.rate_base),v=Number(y.minimal_distance?y.minimal_distance:y.km_base),P=Number(y.value_per_distance?y.value_per_distance:y.km_unit_value),T=Number(y.peripheries?y.peripheries:y.neighboring_base);console.log("Taxes",this.auth.user.taxes);var I=0;if("Motorizado"==M||"Carry"==M)d>v?(u=G+(I=Math.abs(d-v))*P,console.log("Price Carry",u)):u=G,1==l&&(u+=T);else if("Autom\xf3vil"==M){if(d>v){const h=P*(I=Math.abs(d-v))+I*(.25*P);console.log("Distance chage price",h),u=G+h,u=Math.round(u)}else u=G;1==l&&(u+=T)}return console.log("price es :"+u+" rate "+P),u}}return g.\u0275fac=function(d){return new(d||g)(E.LFG(S.s),E.LFG(Z.F),E.LFG(A.e))},g.\u0275prov=E.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()}}]);