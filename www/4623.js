"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4623],{6640:(P,m,a)=>{a.d(m,{B:()=>T});var i=a(5e3),f=a(1892),l=a(9808),u=a(9928);function _(t,p){if(1&t){const s=i.EpF();i.TgZ(0,"ion-item",4),i.NdJ("click",function(){i.CHM(s);const v=i.oxw().$implicit,Z=i.oxw();return i.KtG(Z.callANumber(v.driver_phone))}),i.TgZ(1,"ion-text",1),i._uU(2),i.qZA(),i.TgZ(3,"ion-button",5),i._UZ(4,"ion-icon",6),i.qZA()()}if(2&t){const s=i.oxw().$implicit;i.xp6(2),i.hij(" ",s.driver_phone," ")}}function x(t,p){if(1&t){const s=i.EpF();i.ynx(0),i.TgZ(1,"ion-item")(2,"ion-avatar",1)(3,"img",2),i.NdJ("click",function(){i.CHM(s);const v=i.oxw();return i.KtG(v.viewImage(v.photo))}),i.qZA()(),i.TgZ(4,"ion-text"),i._uU(5),i.qZA()(),i.YNc(6,_,5,1,"ion-item",3),i.BQk()}if(2&t){const s=p.$implicit,g=i.oxw();i.xp6(3),i.Q6J("src",g.photo?g.photo:"assets/imgs/avatar.svg",i.LSH),i.xp6(2),i.hij(" ",s.driver_name," "),i.xp6(1),i.Q6J("ngIf",25!=g.order.status_order)}}let T=(()=>{class t{constructor(s){this.ui=s,this.photo="assets/imgs/avatar.svg"}ngOnInit(){this.driver.length>0&&(this.photo=this.driver[0].photo_driver)}callANumber(s){console.log("Phone",s),this.ui.call(s)}viewImage(s){this.ui.viewImage(s)}}return t.\u0275fac=function(s){return new(s||t)(i.Y36(f.F))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-driver-popover"]],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["slot","start"],[3,"src","click"],["lines","none",3,"click",4,"ngIf"],["lines","none",3,"click"],["expand","block","mode","ios","color","success","slot","end",2,"--border-radius","50%"],["name","call-outline"]],template:function(s,g){1&s&&i.YNc(0,x,7,3,"ng-container",0),2&s&&i.Q6J("ngForOf",g.driver)},dependencies:[l.sg,l.O5,u.BJ,u.YG,u.gu,u.Ie,u.yW]}),t})()},4623:(P,m,a)=>{a.r(m),a.d(m,{OrdersPageModule:()=>J});var i=a(9808),f=a(4182),l=a(9928),u=a(3769),_=a(655),x=a(5338),T=a(6640),t=a(5e3),p=a(1335),s=a(1892),g=a(7556),v=a(9099);function Z(r,d){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",30),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,c=t.oxw(2);return t.KtG(c.cancel(o))}),t._UZ(1,"ion-icon",31),t.qZA()}}function w(r,d){if(1&r&&(t.TgZ(0,"div",14)(1,"div",12)(2,"strong",32),t._uU(3),t.qZA()()()),2&r){const e=d.$implicit;t.xp6(3),t.Oqu(e.address)}}function y(r,d){if(1&r&&(t.TgZ(0,"div",14)(1,"div",12)(2,"p",33),t._uU(3," N\xfamero de horas : "),t.qZA()(),t.TgZ(4,"div",34)(5,"strong"),t._uU(6),t.qZA()()()),2&r){const e=t.oxw().$implicit;t.xp6(6),t.Oqu(e.number_hours)}}function A(r,d){if(1&r&&(t.ynx(0),t.TgZ(1,"div",14)(2,"div")(3,"p",15),t._uU(4," Ciudad : "),t.TgZ(5,"strong"),t._uU(6),t.qZA()()()(),t.TgZ(7,"div",14)(8,"div")(9,"p",15),t._uU(10," Recorrido :"),t.TgZ(11,"strong"),t._uU(12),t.qZA()()()(),t.TgZ(13,"div",14)(14,"div",33)(15,"p",15),t._uU(16," Valor declarado : "),t.TgZ(17,"strong"),t._uU(18),t.qZA()()()(),t.TgZ(19,"div",14)(20,"div")(21,"p",15),t._uU(22," Tipo de accesorio : "),t.TgZ(23,"strong"),t._uU(24),t.qZA()()()(),t.TgZ(25,"div",14)(26,"div")(27,"p",35),t._uU(28," M\xe9todo de pago : "),t.TgZ(29,"strong"),t._uU(30),t.qZA()()()(),t.BQk()),2&r){const e=t.oxw().$implicit;t.xp6(6),t.Oqu(e.city),t.xp6(6),t.Oqu(1==e.round_trip?"Ida y Vuelta":"Ida"),t.xp6(6),t.Oqu(e.declared_value),t.xp6(6),t.Oqu(e.accessory_type),t.xp6(6),t.Oqu(e.payment_method)}}function C(r,d){if(1&r){const e=t.EpF();t.TgZ(0,"ion-col",20),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,c=t.oxw(2);return t.KtG(c.view_driver(o))}),t.TgZ(1,"ion-button",36),t._UZ(2,"ion-icon",37),t.qZA()()}}const M=function(r){return{hidden:r}};function U(r,d){if(1&r&&(t.TgZ(0,"h6",38),t._uU(1,"Estamos buscando al mensajero m\xe1s cercano"),t.qZA()),2&r){const e=t.oxw().$implicit;t.Q6J("ngClass",t.VKq(1,M,!e.view_more))}}function I(r,d){if(1&r){const e=t.EpF();t.TgZ(0,"ion-card",8)(1,"ion-card-content",9),t.YNc(2,Z,2,0,"ion-button",10),t.TgZ(3,"div",11)(4,"div",12),t._uU(5),t.qZA(),t.TgZ(6,"div",13),t._uU(7),t.qZA()(),t.TgZ(8,"div",14)(9,"div")(10,"p",15),t._uU(11,"Tipo de Servicio : "),t.TgZ(12,"strong"),t._uU(13),t.qZA()()()(),t.YNc(14,w,4,1,"div",16),t.YNc(15,y,7,1,"div",17),t.TgZ(16,"div",14)(17,"div")(18,"p",15),t._uU(19,"Total : "),t.TgZ(20,"strong"),t._uU(21),t.qZA()()()(),t.YNc(22,A,31,5,"ng-container",18),t.TgZ(23,"ion-row",19)(24,"ion-col",20),t.NdJ("click",function(){const c=t.CHM(e).$implicit,h=t.oxw(2);return t.KtG(h.view_order(c))}),t.TgZ(25,"ion-button",21),t._UZ(26,"ion-icon",22),t.qZA()(),t.YNc(27,C,3,0,"ion-col",23),t.TgZ(28,"ion-col",24)(29,"p",25)(30,"strong"),t._uU(31),t.qZA()()(),t.YNc(32,U,2,3,"h6",26),t.qZA()(),t.TgZ(33,"div",27),t.NdJ("click",function(){const c=t.CHM(e).$implicit,h=t.oxw(2);return t.KtG(h.viewMore(c))}),t.TgZ(34,"ion-button",28),t._UZ(35,"ion-icon",29),t.qZA()()()}if(2&r){const e=d.$implicit,n=t.oxw(2);t.xp6(2),t.Q6J("ngIf",22==e.status_order),t.xp6(3),t.hij(" ORDEN #",e.id," "),t.xp6(2),t.hij(" ",e.date," "),t.xp6(6),t.Oqu(e.service_type),t.xp6(1),t.Q6J("ngForOf",n.filterFirstTwo(e.detail)),t.xp6(1),t.Q6J("ngIf",3==e.service_type_id),t.xp6(6),t.Oqu(e.total),t.xp6(1),t.Q6J("ngIf",e.view_more),t.xp6(5),t.Q6J("ngIf",e.drivers.length>0),t.xp6(1),t.Q6J("offset",e.drivers.length>0?0:4),t.xp6(2),t.Tol(e.color),t.xp6(1),t.Oqu(e.state_order),t.xp6(1),t.Q6J("ngIf",22==e.status_order),t.xp6(3),t.Q6J("name",e.view_more?"chevron-up-outline":"chevron-down-outline")}}function q(r,d){if(1&r&&(t.ynx(0),t.TgZ(1,"ion-list",6),t.YNc(2,I,36,15,"ion-card",7),t.qZA(),t.BQk()),2&r){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.orders)}}function E(r,d){1&r&&(t.TgZ(0,"ion-item",39)(1,"h4",40),t._uU(2,"No tiene ordenes pendientes"),t.qZA()())}const F=[{path:"",component:(()=>{class r{constructor(e,n,o,c,h){this.request=e,this.ui=n,this.auth=o,this.router=c,this.realtime=h,this.orders=[]}ngOnInit(){}ionViewWillEnter(){return(0,_.mG)(this,void 0,void 0,function*(){this.hideCart(),this.loadData(),this.subscription&&this.subscription.unsubscribe(),this.subscription=this.realtime.getFirebaseCollectionList("status_order_mobile/"+this.auth.person.city_id+"/"+this.auth.user.id).subscribe(e=>{null!=e&&e.length>0&&this.orders.length>0&&e.map(n=>{const o=this.orders.find(c=>c.id==n.order_id);o&&(n.drivers&&n.drivers.length>0&&(o.drivers=n.drivers),o.status_order=n.status_order,o.color="button-red",o.state_order="No asignada","23"==o.status_order?(o.color="button-orange",o.state_order="Asignada"):"24"==o.status_order?(o.color="button-yellow",o.state_order="En proceso"):"25"==o.status_order?(o.color="button-green",o.state_order="Finalizado",this.ui.showToast("La orden #"+n.order_id+" Ha sido finalizada, ahora puede verla en su historial",()=>{this.orders=this.orders.filter(c=>c.status_order>=22&&c.status_order<25)})):"36"==o.status_order?(o.color="button-gray",o.state_order="Cancelada Msj"):"31"==o.status_order&&(o.color="button-cancel",o.state_order="Cancelada"))})})})}ionViewWillLeave(){console.log("ionViewWillLeave"),this.subscription&&this.subscription.unsubscribe()}hideCart(){this.auth.person.hide_cart=!0,this.auth.setPerson(this.auth.person)}viewMore(e){e.view_more=e.view_more?0:1}filterFirstTwo(e){return e.filter((n,o)=>o>=0&&o<=1)}cancel(e){return(0,_.mG)(this,void 0,void 0,function*(){yield this.ui.presentAlert({mode:"ios",header:"\xbfEst\xe1s seguro que quieres cancelar la orden?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:n=>{}},{text:"S\xed",handler:n=>(0,_.mG)(this,void 0,void 0,function*(){yield this.ui.presentAlert({mode:"ios",header:"\xbfPor qu\xe9 desea cancelarla?",inputs:[{name:"why",id:"paragraph",type:"textarea",placeholder:"Raz\xf3n",mode:"ios"}],buttons:[{text:"Enviar",handler:o=>(0,_.mG)(this,void 0,void 0,function*(){(new FormData).append("description",o.why);const h={description:o.why},b=yield this.ui.loading("Por favor espere...");this.request.put("order/cancel_an_order/"+e.id,h).subscribe(D=>(0,_.mG)(this,void 0,void 0,function*(){(yield b).dismiss(),this.orders=this.orders.filter(O=>O.status_order>=22&&O.status_order<25)}),D=>(0,_.mG)(this,void 0,void 0,function*(){(yield b).dismiss(),yield this.ui.presentAlert({mode:"ios",header:"No se ha podido cancelar la orden",buttons:[{text:"Aceptar",role:"cancel",handler:()=>{}}]})}))})}]})})}]})})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}loadData(){return(0,_.mG)(this,void 0,void 0,function*(){this.orders=[];const e=yield this.ui.loading("Por favor espere...");this.request.get("order?customer_id="+this.auth.user.id+"&per_page=25").subscribe(n=>(0,_.mG)(this,void 0,void 0,function*(){(yield e).dismiss(),console.log("res",n.data.data),this.orders=n.data.data,this.orders=this.orders.filter(o=>o.status_order>=22&&o.status_order<25),this.orders.forEach(o=>{o.color="button-red",o.state_order="No asignada","23"==o.status_order?(o.color="button-orange",o.state_order="Asignada"):"24"==o.status_order?(o.color="button-yellow",o.state_order="En proceso"):"25"==o.status_order?(o.color="button-green",o.state_order="Finalizado"):"36"==o.status_order?(o.color="button-gray",o.state_order="Cancelada Msj"):"31"==o.status_order&&(o.color="button-cancel",o.state_order="Cancelada")})}),n=>(0,_.mG)(this,void 0,void 0,function*(){(yield e).dismiss()}))})}goToTransportType(){localStorage.setItem("step","1"),this.router.navigate(["tabs/transport-type"])}view_order(e){return(0,_.mG)(this,void 0,void 0,function*(){(yield this.ui.presentModal(x.G,{order:e},["custom-modal"])).onDidDismiss().then(o=>{this.orders=this.orders.filter(c=>c.status_order>=22&&c.status_order<25)})})}view_driver(e){this.ui.presentPopover(T.B,{driver:e.drivers})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(p.s),t.Y36(s.F),t.Y36(g.e),t.Y36(u.F0),t.Y36(v.i))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-orders"]],decls:9,vars:2,consts:[[1,"ion-text-center"],[4,"ngIf","ngIfElse"],["elseT",""],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","add"],["mode","ios","color","warning"],["style","margin-bottom: 10px;",4,"ngFor","ngForOf"],[2,"margin-bottom","10px"],[2,"padding-top","0px","padding-bottom","0px"],["style","--border-radius: 50%;\n          width: 25px;\n          height: 25px;\n          font-size: 0.5em;\n          text-align: center;","color","danger","size","small",3,"click",4,"ngIf"],[2,"width","100%","display","flex"],[1,"w-50"],[2,"width","50%","text-align","right"],[1,"row"],[1,"",2,"font-size","0.8em"],["class","row",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center",2,"transition","all ease 2s"],["size","4",3,"click"],[2,"height","40px","width","40px","font-size","10px","font-weight","bold"],["name","eye-outline"],["size","4",3,"click",4,"ngIf"],["size","4",3,"offset"],[2,"margin-top","20px"],["class","ion-text-center",3,"ngClass",4,"ngIf"],[1,"row","ion-text-center","justify-content-center",3,"click"],["fill","clear",2,"height","20px"],[3,"name"],["color","danger","size","small",2,"--border-radius","50%","width","25px","height","25px","font-size","0.5em","text-align","center",3,"click"],["name","close"],[2,"font-size","0.7em"],[1,""],[2,"width","50%"],[2,"font-size","0.8em"],["expand","block","color","success",2,"height","40px","width","40px","font-size","10px","font-weight","bold","margin","auto"],["name","person-outline"],[1,"ion-text-center",3,"ngClass"],["lines","none"],[1,"ion-text-center",2,"width","100%"]],template:function(e,n){if(1&e&&(t.TgZ(0,"h5",0),t._uU(1,"Listado de ordenes"),t.qZA(),t.TgZ(2,"ion-content"),t.YNc(3,q,3,1,"ng-container",1),t.YNc(4,E,3,0,"ng-template",null,2,t.W1O),t.TgZ(6,"ion-fab",3)(7,"ion-fab-button",4),t.NdJ("click",function(){return n.goToTransportType()}),t._UZ(8,"ion-icon",5),t.qZA()()()),2&e){const o=t.MAs(5);t.xp6(3),t.Q6J("ngIf",n.orders.length>0)("ngIfElse",o)}},dependencies:[i.mk,i.sg,i.O5,l.YG,l.PM,l.FN,l.wI,l.W2,l.IJ,l.W4,l.gu,l.Ie,l.q_,l.Nd],styles:[".button-orange[_ngcontent-%COMP%]{color:orange}.button-yellow[_ngcontent-%COMP%]{color:#dddf00}.button-green[_ngcontent-%COMP%]{color:green}.button-red[_ngcontent-%COMP%]{color:red}.button-gray[_ngcontent-%COMP%]{color:#ce4257}.button-cancel[_ngcontent-%COMP%]{color:#95b2b0}"]}),r})()}];let N=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[u.Bz.forChild(F),u.Bz]}),r})(),J=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[i.ez,f.u5,l.Pc,N]}),r})()}}]);